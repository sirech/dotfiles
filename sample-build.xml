<?xml version="1.0"?>
<project name="{name}" default="dist" basedir=".">
  <description>
    Build file for the {name} workspace
  </description>

  <property environment="env"/>
  <property file="build.properties"/>

  <!-- can be overridden at the command line with -Dversion=
       or in IDEA, in the ant properties dialog -->
  <property name="version" value="snapshot"/>

  <path id="classpath.build">
    <fileset dir="${lib.dir}">
      <include name="*.jar"/>
    </fileset>

  </path>

  <path id="classpath.test">

    <path refid="classpath.build"/>
    <pathelement location="${build.dir}/classes" />

  </path>

  <path id="classpath.run">

    <path refid="classpath.build"/>
    <pathelement location="${dist.dir}/lib/${ant.project.name}.jar" />

  </path>

  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.dir}/classes"/>
    <mkdir dir="${build.dir}/test"/>
  </target>

  <target name="compile" depends="init"
          description="compile the source " >
    <javac
        srcdir="${src.dir}"
        destdir="${build.dir}/classes"
        debug="on"
        >
      <classpath refid="classpath.build"/>
    </javac>
  </target>

  <target name="test.compile" depends="compile"
          description="compile test source">
    <javac
        srcdir="${test.dir}"
        destdir="${build.dir}/test"
        debug="on"
        >
      <classpath refid="classpath.test"/>
    </javac>
  </target>

  <target name="test" depends="test.compile"
          description="execute unit tests">
    <junit
        fork="yes"
        haltonfailure="yes"
        failureProperty="test.failure">
      <classpath>
        <pathelement location="${build.dir}/test"/>
        <path refid="classpath.test"/>
      </classpath>
      <formatter type="brief" usefile="false" />
      <batchtest fork="yes">
        <fileset dir="${build.dir}/test" includes="**/*Test.*"/>
      </batchtest>
      <!-- <jvmarg value="-Xmx1024M" /> -->
    </junit>
    <fail message="tests failed" if="test.failure" />
  </target>

  <target name="dist" depends="compile"
          description="generate the distribution" >
    <mkdir dir="${dist.dir}/lib"/>
    <jar jarfile="${dist.dir}/lib/{name}-${DSTAMP}.jar" basedir="${build.dir}"/>
  </target>

  <target name="clean"
          description="clean up" >
    <delete dir="${dist.dir}"/>
    <delete dir="${build.dir}"/>
  </target>

  <target name="javadoc"
          description="Generate Javadocs.">
    <delete dir="${build.dir}/javadoc"/>
    <mkdir dir="${build.dir}/javadoc"/>
    <javadoc packagenames="com.hceris.algorithms,com.hceris.utils"
             destdir="${build.dir}/javadoc"
             use="true"
             author="true"
             protected="true"
             windowtitle="{name} ${version}">
      <sourcepath>
        <pathelement location="${src.dir}"/>
        <pathelement location="${env.JAVA_HOME}/src"/>
      </sourcepath>
      <link href="http://java.sun.com/javase/6/docs/api"/>
    </javadoc>
  </target>

</project>
